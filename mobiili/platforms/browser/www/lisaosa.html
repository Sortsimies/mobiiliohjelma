<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />

 	<meta http-equiv="Content-Security-Policy" content="
		default-src 'self' 'unsafe-inline'  http://cdn.jtsage.com http://ajax.aspnetcdn.com ws://192.168.1.123:3000 https://mts.googleapis.com https://fonts.googleapis.com https://fonts.gstatic.com http://code.jquery.com https://code.jquery.com https://maps.googleapis.com https://maps.gstatic.com  https://csi.gstatic.com https://ssl.gstatic.com gap: data: blob: filesystem: ; 
	" /> 
	
    <link rel="stylesheet"
    href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />

	<script
	src="https://code.jquery.com/jquery-2.1.4.js"
	integrity="sha256-siFczlgw4jULnUICcdm9gjQPZkw/YPDqhQ9+nAOScE4="
	crossorigin="anonymous"></script>
	
	<script 
    src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
	
	<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.15.0/jquery.validate.min.js"></script>
	<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.15.0/additional-methods.min.js"></script>
	
	<link  rel="stylesheet" href="http://cdn.jtsage.com/jtsage-datebox/4.0.0/jtsage-datebox-4.0.0.jqm.min.css">
	<script src="http://cdn.jtsage.com/jtsage-datebox/4.0.0/jtsage-datebox-4.0.0.jqm.min.js"></script>
	<script src="http://cdn.jtsage.com/jtsage-datebox/i18n/jtsage-datebox.i18n.fi.utf8.min.js"></script>

    <link rel="stylesheet" type="text/css" href="css/index.css" />
	
	<style type="text/css">	

	.alku-btn {
		width: 9em !important;
	}

	#menu {
		margin-top: -0.15em;
	}
	
	#out {
		margin-top: -0.25em;
	}
	
	div[data-role="header"], div[data-role="footer"], #out, #menu {
		background-color: #E4E4E4 !important;
		border: none;
	}
	
	.virhe {
		color: red;
	}
	
	label.errorL {
	   /* color:red; */
	   font-weight: bold;
	}
	
	input.errorF {
		border-bottom-color: red;
		border-style: solid;
		border-width: 0.2em;
	}

	html, body {
	   height: 100%;
	   margin: 0;
	   padding: 0;
	}
	  
	#map {
	   height: 100%;
	} 

	</style>

    <title>Mobiiliohjelmointi</title>
</head>

<body>	

	<div data-role="popup" id="popupMenu" data-transition="pop" data-theme="a">
		<a href="#" data-rel="back" class="ui-btn ui-btn-inline ui-corner-all ui-icon-delete ui-btn-icon-notext ui-btn-right">Sulje</a>

		<ul data-role="listview">
			<li><a href="#etusivu" class="ui-btn">Etusivu</a></li>  
			<li><a href="#kartta" class="ui-btn">Kartta</a></li>
			<li><a href="#ulos" class="out ui-btn">Kirjaudu ulos</a></li>
		</ul>
	</div>
	
	<div data-role="header" data-position="fixed"> 				
		<h1 id="headerOtsikko"></h1>				
		<a href="#ulos" id="out" class="out ui-btn ui-btn-right">Kirjaudu ulos</a>
		<a href="#popupMenu" id="menu" data-rel="popup" data-transition="flip" class="ui-btn ui-btn-left ui-btn-icon-left ui-icon-bars ui-btn-icon-notext">Menu</a>
	</div>		
	
	<div data-role="page" id="etusivu" data-title="Etusivu">

		<div role="main" class="ui-content ui-body-a">
			<a href="#rekisterointi" id="reg" class="alku-btn ui-btn ui-btn-inline ui-corner-all ui-mini">Rekisteröidy</a>
			<a href="#" id="kir" class="alku-btn ui-btn ui-btn-inline ui-corner-all ui-mini">Kirjaudu</a>	
		</div>
		
		<div data-role="footer" data-position="fixed">
			<h1>Mobiiliohjelmointi</h1>
		</div>
		
	</div>
			
		<!-- 
		data-rel="popup" data-position-to="window" class="ui-btn ui-btn-right ui-btn-inline" data-transition="pop">Rekisteröidy</a>
		<div data-role="popup" id="rekisterointi" data-theme="a" data-overlay-theme="b" class="ui-corner-all ui-content ui-shadow" data-dismissible="false">
		 -->
	<div data-role="page" id="rekisterointi" data-title="Rekisteröidy">
		
		<div role="main" class="ui-content ui-body-a">
		
			<!-- Jotta validointi tietää kenttänsä -->
			<form id="rekisterointiForm">
				<div class="ui-field-contain">
					<label for="kayttajatunnus">Käyttäjätunnus:</label>
					<input name="kayttajatunnus" id="kayttajatunnus" type="text"  class="tarkastaTunnus"/>
				</div>
				<div class="ui-field-contain">
					<label for="spaiva">Syntymäpäivä:</label>
					<input name="spaiva" id="spaiva" type="text" class="tarkastaIka" />
				</div>
				<div class="ui-field-contain">
					<label for="email">Email:</label>
					<input name="email" id="email" type="email" />
				</div>
				<div class="ui-field-contain">
					<label for="salasana1">Salasana:</label>
					<input name="salasana1" id="salasana1" type="password" class="tarkastaSalasana"/>
				</div>
				<div class="ui-field-contain">
					<label for="salasana2">Salasana uudestaan:</label>
					<input name="salasana2" id="salasana2" type="password" />
				</div>
				<div class="ui-field-contain">
					<button type="button" id="rekisteroidy" class="ui-btn ui-corner-all ui-btn-b ui-btn-icon-left ui-icon-check ui-btn-inline">Rekisteröidy</button>
					<!-- Linkki, jotta validaattori ei validoisi -->
					<a href="#etusivu" id="peruuta" class="ui-btn ui-corner-all ui-btn-a ui-btn-icon-left ui-icon-delete ui-btn-inline">Peruuta</a>
				</div>			
			</form>	
		</div>
		
		<div data-role="footer" data-position="fixed">
			<h1>Mobiiliohjelmointi</h1>
		</div>

	</div>	
	
	<div data-role="page" id="kartta" data-title="Kartta">

		<div role="main" class="ui-content ui-body-a">
			<div id="map"></div> 
		</div>
		
		<div data-role="footer" data-position="fixed">
			<h1>Mobiiliohjelmointi</h1>
		</div>
		
	</div>
	
	<div data-role="page" id="ulos" data-title="Ulos">

		<div role="main" class="ui-content ui-body-a">
			
		</div>
		
		<div data-role="footer" data-position="fixed">
			<h1>Mobiiliohjelmointi</h1>
		</div>
		
	</div>
	
<!--
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
-->
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB3i51aqHjEzulU5uHuDB4peX8EUv5OxvA"></script>
	
    <script type="text/javascript">
		
		var regOK = true;
		
		$(document).one("pagebeforecreate", function () {
			$( "[data-role='header']" ).enhanceWithin().toolbar(); // Koska on sisältöä
			$("#popupMenu").enhanceWithin().popup(); 
		});
		
		
		$(document).on("pagecreate", function() {
			$("#out").hide();
			$("#menu").hide();

			$(document).on("pagecontainerbeforeshow", function(event, data) {
				if (regOK) {
					$("#out").show();
					$("#menu").show();
				} else {
					$("#out").hide();
					$("#menu").hide();				
				}
				
				var activePage = $.mobile.pageContainer.pagecontainer("getActivePage");
				$("#headerOtsikko").text(activePage.jqmData("title"));
				
				var toPage = data.toPage[0].id;
				
				if (toPage == "ulos") {
					regOK = false;
					data.toPage[0] = $("#etusivu")[0];
					
					$.extend(data.options, {changeHash: false})
				} else if (toPage == "kartta" && ! regOK) {
					data.toPage[0] = $("#etusivu")[0];
					
					$.extend(data.options, {changeHash: false})
				}
			})
				
			$(document).on("pagecontainershow", function(){
				$(".ui-content").height(getRealContentHeight());
			})

			$(window).on("resize orientationchange", function(){
				$(".ui-content").height(getRealContentHeight());
			})
			
			function getRealContentHeight() {
				var activePage = $.mobile.pageContainer.pagecontainer("getActivePage"),
					screen = $.mobile.getScreenHeight(),
					header = $(".ui-header").hasClass("ui-header-fixed") ? $(".ui-header").outerHeight() - 1 : $(".ui-header").outerHeight(),
					footer = $(".ui-footer").hasClass("ui-footer-fixed") ? $(".ui-footer").outerHeight() - 1 : $(".ui-footer").outerHeight(),
					contentMargins = $(".ui-content", activePage).outerHeight() - $(".ui-content", activePage).height();
				
				var contentHeight = screen - header - footer - contentMargins;	
				
				return contentHeight;
			}
		
		})
		
		$(document).on("pagecreate", "#ulos", function() {

			$(document).on("pagecontainerbeforeshow", function() {
				
			});
		})

		
		$(document).on("pagecreate", "#etusivu", function() {

		})

		
		$(document).on("pagecreate", "#rekisterointi", function() {
			
			$("#spaiva").datebox({
				mode: "datebox", 
				beforeToday: true, 
				useFocus: true,
			})
			 
			$("#rekisteroidy").on("tap", function() {		
				if ($("#rekisterointiForm").valid()) {
					regOK = true;
					// JSONilla tiedot kantaan
					tyhjennaLomake();
					$.mobile.pageContainer.pagecontainer("change", "#etusivu");
				}
			})
			
			$("#peruuta").on("tap", function() {		
				tyhjennaLomake();
			})
			
			$("#rekisterointiForm #spaiva").on("change", function() {
				$("#rekisterointiForm").validate().element(this);
			})

		})
		
		$(document).on("pagecreate", "#kartta", function() {
			$(document).on("pagecontainershow", function() {
				teeMap();
			})
		})
		
		var validator = $("#rekisterointiForm").validate({	
	
			errorClass: "virhe",				
			rules: {
				kayttajatunnus:  {
					required: true,
					minlength: 6,
					maxlength: 10,
				},	
				spaiva:  {
					required: true,
				},
				email:  {
					required: true,
					email: true,
				},	
				salasana1:  {
					required: true,
				},
				salasana2:  {
					equalTo: "#salasana1",
				},	
			},
			messages: {
				kayttajatunnus: {
					required: "Pakollinen",
					minlength: jQuery.validator.format("min. {0} merkkiä"),
					maxlength: jQuery.validator.format("max. {0} merkkiä"),
				},
				spaiva: {
					required: "Pakollinen",
				},
				email: {
					required: "Pakollinen",
					email: "Anna kelvollinen email"
				},
				salasana1: {
					required: "Pakollinen",
					minlength: jQuery.validator.format("min. {0} merkkiä"),
				},
				salasana2: {
					equalTo: "Salasanat eivät täsmää"
				},
			},
			highlight: function(element) {
				$(element).addClass('errorF');
				$(element.form).find("label[for=" + element.id + "]").addClass("errorL");
			}, 
			unhighlight: function(element) {
				$(element).removeClass('errorF');
				$(element.form).find("label[for=" + element.id + "]").removeClass("errorL");
			},
			errorPlacement: function(error, element ) {
				error.insertAfter(element.parent());
			},
			submitHandler: function (form) {

			},
		
		})
		
		jQuery.validator.addMethod("tarkastaTunnus", function(value, element) {
			return ! /[^a-z]/.test(value);
		}, "Tunnukseen vain a-z")
		
		jQuery.validator.addMethod("tarkastaIka", function(value, element) {
			return onko18(value);
		}, "Vähintään 18 vuotta")
		
		jQuery.validator.addMethod("tarkastaSalasana", function(value, element) {
			return /\W/.test(value);
		}, "Vähintään yksi erikoismerkki")
		

		function onko18(value) {
			var tanaan = new Date();
			
			var vuosi = tanaan.getFullYear() - value.substr(6, 4);
			var kuukausi = (parseInt(tanaan.getMonth()) + 1) - value.substr(3, 2);
			var paiva = tanaan.getDate() - value.substr(0, 2);
		
			if (vuosi < 18 || (vuosi == 18 && kuukausi < 0) || (vuosi == 18 && kuukausi == 0 && paiva < 0)) {
				return false;
			}
			return true;
		}
		
		function tyhjennaLomake() {
			$("#rekisterointiForm input").each(function() {
				$(this).val("");
			})
			
			validator.resetForm();
		}
		
		function teeMap() {
			var map = new google.maps.Map(document.getElementById('map'), {
				center: {lat: 60.2013725, lng: 24.9340407},
				zoom: 14,
				mapTypeId: google.maps.MapTypeId.ROADMAP,
			})
			
			var marker = new google.maps.Marker({
				position: {lat: 60.2013725, lng: 24.9340407},
				map: map,
				title: 'Hello World!'
			})
			
			var infowindow = new google.maps.InfoWindow({
				content: "Haaga-Helia on johtava amk",
			})
			
			marker.addListener('click', function() {
				infowindow.open(map, marker);
			})



      }

    </script>

</body>

</html>